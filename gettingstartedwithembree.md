Getting Started with Intel Embree for Windows

## Introduction

If you have a recent Intel Processor, or Intel GPU, or even a mac with an ARM-based processor, you can get started on programming with Ray Tracing samples with C++ & C. I'll be using Visual Studio 2022 Community with Intel's Embree Ray Tracing library (recent new version 4.2.0). There's a few steps to everything installed, but afterwards you'll be able to get going with Ray Tracing development!

Get Started with the Intel oneAPI Rendering Toolkit for Windows. The following instructions are valid as of early September 2023 with Visual Studio Community 2022, Intel oneAPI Base Toolkit 2023.2.0.49396, Intel RenderKit 2023.2.0.49368, and Embree 4.2.0.   Intel Embree Raytracing, which works on either Intel CPUs or GPUs, as well as Macs with ARM processors, is included in the Intel Rendering Toolkit. For the purposes of this tutorial, I'm using using oneAPI with Windows. 
https://www.intel.com/content/www/us/en/docs/oneapi-rendering-toolkit/get-started-guide-windows/2023-2/overview.html

## Overview
1. Configure your system
2. Build and run sample applications.
3. Run the pre-compiled sample applications
4. Next steps

## Steps
1. ### Configure your system
	1. Install Visual Studio Community 2022. [Install Microsoft Visual Studio* with CMake* and Windows* SDK](https://www.intel.com/content/www/us/en/docs/oneapi-rendering-toolkit/get-started-guide-windows/2023-2/configure-your-system.html) to build the samples      ![[\img\_vs2022.png]] from https://visualstudio.microsoft.com/downloads/        VisualStudioSetup.exe             ![[\img\_vs2022cppCMake.png]]
	1. ### Install the IntelÂ® oneAPI Base Toolkit (Base Kit). https://www.intel.com/content/www/us/en/developer/tools/oneapi/base-toolkit-download.html  Select Operating System->Windows. I chose the Offline Installer ( w_BaseKit_p_2023.2.0.49396_offline (~3.7gb)), but you can try the Online Installer.  Complete the installation of the Base Toolkit.
	2. Install Imaging Tools
		1. I didn't go through with this at first, but looking later on at the examples you may want to install a tool such as ImageMagick (to load PPM and PFM files generated by some examples).
	3. Configuration for Intel GPU
		1. I am using a 12th Gen Intel CPU with Intel Iris XE Graphics, and I had all of my drivers installed already, so I didn't complete this step.
	4. Install the oneAPI Rendering Toolkit
		1. https://www.intel.com/content/www/us/en/developer/tools/oneapi/rendering-toolkit-download.html   Choose Operating System->Windows. I chose Offline Installer (w_RenderKit_p_2023.2.0.49368_offline (~570mb)). Complete the installation of the Render Toolkit.  (Reference: https://www.intel.com/content/www/us/en/developer/tools/oneapi/rendering-toolkit.html)
	5. I suggest doing a computer reboot after installing all of this stuff.
2. ### Build and Run Sample Projects Using the Visual Studio* Command Line
	1.  Now you can run a oneAPI sample. You can build a sample by downloading it from a location and running CMake to build it  OR you can get started using the Code Sample Browser for Intel oneAPI Toolkits, which is a nifty terminal program that lets you install samples to a directory of your choice and what I'll be using in the following steps. Reference https://www.intel.com/content/www/us/en/docs/oneapi-rendering-toolkit/get-started-guide-windows/2023-2/build-and-run-sample-with-command-line.html)
	2.  Start by running "x64 Native Tools Command Prompt for VS 2022" from the Windows Start Menu. It should be installed after installing the toolkits.
	3. Now is a good time to make a directory to keep your samples and other working files in. I suggest something on your C: drive like C:\oneAPIRendering.  CD to that directory.
	4. The documentation has a setvars.bat batch file to be run each time you make (or use?) a new sample as well as the Code Sample Browser. This wasn't clear to me at first, so that's why I'm mentioning it. If, later on, you try to run a sample and you get a missing .dll error (like embree4.dll not found, etc.) try setting the environment variables again to see if it fixes it. For right now, run this line from the terminal to set your environment variables:
		1. call "C:\Program Files (x86)\Intel\oneAPI\setvars.bat"
	5. From the terminal, run the Code Sample Browser for Intel oneAPI Toolkits with C++ and C samples. (If you need to close the Sample Browser press Ctrl-C)
		1. oneapi-cli -l cpp,c
		2. The oneAPI CLI menu appears.  Select "(1) Create a project" and press Enter. The language selection menu will appear. For the first few samples, select cpp (for C++). There's other samples that are in C, but you can try those later if you want.
		3. The toolkit samples list appears. Use the arrow down key to scroll down to oneAPI Libraries > Embree > Intel Embree Getting Started (02_embree_gsg)  and press Enter. Specify a location to download the project to. I suggest using the working directory you made earlier (ex: C:\oneAPIRendering\02_embree_gsg\).
	6. In the terminal, navigate to the folder where you downloaded the **02_embree_gsg** sample.
		1. cd C:\oneApiRendering\02_embree_gsg
		2. Run the following commands to build the sample:
			1. cd cpu
			2. mkdir build
			3. cd build
			4. cmake ..
			5. cmake --build . --config Release
			6. The sample should build. If successful, change directory to the release folder   (cd Release)
			7. Run the exe (minimal.exe)
			8. The output should show: ![[\img\_trianglegeo.png]]
			9. You can look at the source code by looking through the \src folder in the sample. For this sample there's just minimal.cpp.
	7. Now you're able to try out other samples from the Code Sample Browser.
3. ### Run the pre-compiled sample applications.
	1. Intel has a page discussing some pre-compiled applications you can try. I found these were installed in the following directory for me (C:\Program Files (x86)\Intel\oneAPI\embree\4.1.0\bin).
	2. Triangle Geometry Ray Tracing sample application. 
		1. In the 'Run a pre-compiled triangle_geometry application' page, it mentions running triangle_geometry.exe, but I found that this program as well as the other ones in the directory have the name embree appended to the filenames, so it may have changed for Embree 4. So, you can run it from the terminal at 'C:\Program Files (x86)\Intel\oneAPI\embree\4.1.0\bin\embree_triangle_geometry.exe'.  NOTE (IMPORTANT): If this is your first time running one of these examples, Ray Tracing may run all of your CPU cores at 100% which will quickly raise the temperature of the CPU. In some examples (like in OSPRay Studio) you can set an Accumulation rate which will, as it appears to me, to stop the Ray Tracing after the specified number of accumulation steps, therefore preventing your CPU and CPU temp. from maxing out. In the terminal run:
			1. call "C:\Program Files (x86)\Intel\oneAPI\setvars.bat"
			2. cd to your C:\oneAPIRendering\ folder, make a new directory there for your triangle program  (ex: ) C:\oneAPIRendering\trianglegeo and CD to it.
			3. mkdir rk_gsg
			4. cd rk_gsg
			5. embree_triangle_geometry.exe
			6. You should see a triangle. You can click and move around to rotate. Use arrow keys to move and rotate. WASD keys work to move too. 
		2. Reference: https://www.intel.com/content/www/us/en/docs/oneapi-rendering-toolkit/get-started-guide-windows/2023-2/run-a-sample-project-with-intel-embree.html
	3. OSPRay Studio Showcase Application
		1. OSPRay Studio has a bunch of examples to try out.
			1. call "C:\Program Files (x86)\Intel\oneAPI\setvars.bat"
			2. cd to your C:\oneAPIRendering\ folder, make a new directory there for your triangle program  (ex: ) C:\oneAPIRendering\ospstudio and CD to it.
			3. mkdir rk_gsg
			4. cd rk_gsg
			5. ospStudio.exe
			6. You should see an interactive rendering window. Go to File -> Demo Scene and load tutorial_scene. Review the selected scene. You can click and move around to rotate. Use arrow keys to move and rotate. WASD keys work to move too. 
		2. Reference: https://www.intel.com/content/www/us/en/docs/oneapi-rendering-toolkit/get-started-guide-windows/2023-2/run-sample-with-intel-ospray-studio.html
	4. Viewer.exe - I wanted to mention there's a embree_viewer.exe program in the \bin  directory (as well as the source code in the \src dir) which is a program that loads .OBJ files for Ray Tracing. Info on this is in the Embree Readme.pdf file, section 10.6. There, it also shows two example files that look really great with the viewer program.
		1. Reference: https://raw.githubusercontent.com/embree/embree/master/readme.pdf
	5. Reference: https://www.intel.com/content/www/us/en/docs/oneapi-rendering-toolkit/get-started-guide-windows/2023-2/run-pre-compiled-samples.html
4. ### Next Steps
	1. API Manuals and other stuff. https://www.intel.com/content/www/us/en/docs/oneapi-rendering-toolkit/get-started-guide-windows/2023-2/next-steps.html
